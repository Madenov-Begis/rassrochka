/**
 * @file: generate-test-excel.js
 * @description: –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö Excel —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
 * @dependencies: exceljs
 * @created: 2024-07-16
 */

const ExcelJS = require('exceljs');
const path = require('path');

// –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
async function generateClientsTemplate() {
  const workbook = new ExcelJS.Workbook();
  const worksheet = workbook.addWorksheet('–ö–ª–∏–µ–Ω—Ç—ã');

  // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
  const headers = [
    '–ò–º—è',
    '–§–∞–º–∏–ª–∏—è', 
    '–û—Ç—á–µ—Å—Ç–≤–æ',
    '–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞',
    '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞',
    '–¢–µ–ª–µ—Ñ–æ–Ω',
    '–ê–¥—Ä–µ—Å'
  ];

  // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
  worksheet.addRow(headers);

  // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
  const testClients = [
    ['–ò–≤–∞–Ω', '–ü–µ—Ç—Ä–æ–≤', '–°–µ—Ä–≥–µ–µ–≤–∏—á', 'AA', '1234567', '+998901112233', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 10, –∫–≤. 5'],
    ['–ú–∞—Ä–∏—è', '–°–∏–¥–æ—Ä–æ–≤–∞', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', 'BB', '7654321', '+998902223344', '–ø—Ä. –ú–∏—Ä–∞, 25, –∫–≤. 12'],
    ['–ê–ª–µ–∫—Å–µ–π', '–ö–æ–∑–ª–æ–≤', '–ò–≤–∞–Ω–æ–≤–∏—á', 'CC', '1111111', '+998903334455', '—É–ª. –ü—É—à–∫–∏–Ω–∞, 7, –∫–≤. 3'],
    ['–ï–ª–µ–Ω–∞', '–ú–æ—Ä–æ–∑–æ–≤–∞', '–ü–µ—Ç—Ä–æ–≤–Ω–∞', 'DD', '2222222', '+998904445566', '—É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 15, –∫–≤. 8'],
    ['–î–º–∏—Ç—Ä–∏–π', '–í–æ–ª–∫–æ–≤', '–ê–Ω–¥—Ä–µ–µ–≤–∏—á', 'EE', '3333333', '+998905556677', '–ø—Ä. –ü–æ–±–µ–¥—ã, 42, –∫–≤. 15'],
    ['–ê–Ω–Ω–∞', '–õ–µ–±–µ–¥–µ–≤–∞', '–î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞', 'FF', '4444444', '+998906667788', '—É–ª. –°–æ–≤–µ—Ç—Å–∫–∞—è, 33, –∫–≤. 7'],
    ['–°–µ—Ä–≥–µ–π', '–°–æ–∫–æ–ª–æ–≤', '–ù–∏–∫–æ–ª–∞–µ–≤–∏—á', 'GG', '5555555', '+998907778899', '—É–ª. –ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤, 18, –∫–≤. 22'],
    ['–û–ª—å–≥–∞', '–ù–æ–≤–∏–∫–æ–≤–∞', '–í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞', 'HH', '6666666', '+998908889900', '–ø—Ä. –õ–µ–Ω–∏–Ω–∞, 55, –∫–≤. 11'],
    ['–ü–∞–≤–µ–ª', '–§–µ–¥–æ—Ä–æ–≤', '–ú–∏—Ö–∞–π–ª–æ–≤–∏—á', 'II', '7777777', '+998909990011', '—É–ª. –ú–∏—Ä–∞, 12, –∫–≤. 4'],
    ['–¢–∞—Ç—å—è–Ω–∞', '–ê–Ω–¥—Ä–µ–µ–≤–∞', '–°–µ—Ä–≥–µ–µ–≤–Ω–∞', 'JJ', '8888888', '+998900001122', '—É–ª. –ü–∞—Ä–∫–æ–≤–∞—è, 8, –∫–≤. 9']
  ];

  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
  testClients.forEach(client => {
    worksheet.addRow(client);
  });

  // –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
  const headerRow = worksheet.getRow(1);
  headerRow.font = { bold: true };
  headerRow.fill = {
    type: 'pattern',
    pattern: 'solid',
    fgColor: { argb: 'FFE0E0E0' }
  };

  // –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
  worksheet.columns.forEach(column => {
    column.width = Math.max(
      ...column.values.map(v => v ? v.toString().length : 0)
    ) + 2;
  });

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
  const filePath = path.join(__dirname, '../docs/import-templates/clients_template.xlsx');
  await workbook.xlsx.writeFile(filePath);
  console.log(`‚úÖ –§–∞–π–ª –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω: ${filePath}`);
}

// –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É –¥–ª—è —Ä–∞—Å—Å—Ä–æ—á–µ–∫
async function generateInstallmentsTemplate() {
  const workbook = new ExcelJS.Workbook();
  const worksheet = workbook.addWorksheet('–†–∞—Å—Å—Ä–æ—á–∫–∏');

  // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ä–∞—Å—Å—Ä–æ—á–µ–∫
  const headers = [
    '–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞',
    '–§–∞–º–∏–ª–∏—è –∫–ª–∏–µ–Ω—Ç–∞',
    '–û—Ç—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–∞', 
    '–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞',
    '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞',
    '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
    '–¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞',
    '–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å',
    '–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞',
    '–°—Ä–æ–∫ (–º–µ—Å—è—Ü–µ–≤)'
  ];

  // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
  worksheet.addRow(headers);

  // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—Ä–æ—á–µ–∫
  const testInstallments = [
    ['–ò–≤–∞–Ω', '–ü–µ—Ç—Ä–æ–≤', '–°–µ—Ä–≥–µ–µ–≤–∏—á', 'AA', '1234567', 'iPhone 15 Pro', '1500000', '300000', '12.5', '12'],
    ['–ú–∞—Ä–∏—è', '–°–∏–¥–æ—Ä–æ–≤–∞', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', 'BB', '7654321', 'MacBook Air M2', '2500000', '500000', '10.0', '18'],
    ['–ê–ª–µ–∫—Å–µ–π', '–ö–æ–∑–ª–æ–≤', '–ò–≤–∞–Ω–æ–≤–∏—á', 'CC', '1111111', 'Samsung Galaxy S24', '1200000', '200000', '15.0', '10'],
    ['–ï–ª–µ–Ω–∞', '–ú–æ—Ä–æ–∑–æ–≤–∞', '–ü–µ—Ç—Ä–æ–≤–Ω–∞', 'DD', '2222222', 'iPad Pro 12.9', '1800000', '400000', '11.5', '15'],
    ['–î–º–∏—Ç—Ä–∏–π', '–í–æ–ª–∫–æ–≤', '–ê–Ω–¥—Ä–µ–µ–≤–∏—á', 'EE', '3333333', 'Dell XPS 13', '2200000', '600000', '9.5', '20'],
    ['–ê–Ω–Ω–∞', '–õ–µ–±–µ–¥–µ–≤–∞', '–î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞', 'FF', '4444444', 'Sony WH-1000XM5', '800000', '150000', '18.0', '8'],
    ['–°–µ—Ä–≥–µ–π', '–°–æ–∫–æ–ª–æ–≤', '–ù–∏–∫–æ–ª–∞–µ–≤–∏—á', 'GG', '5555555', 'Apple Watch Series 9', '600000', '100000', '20.0', '6'],
    ['–û–ª—å–≥–∞', '–ù–æ–≤–∏–∫–æ–≤–∞', '–í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞', 'HH', '6666666', 'LG OLED C3 65"', '3000000', '800000', '8.5', '24'],
    ['–ü–∞–≤–µ–ª', '–§–µ–¥–æ—Ä–æ–≤', '–ú–∏—Ö–∞–π–ª–æ–≤–∏—á', 'II', '7777777', 'Canon EOS R6', '1400000', '300000', '13.0', '12'],
    ['–¢–∞—Ç—å—è–Ω–∞', '–ê–Ω–¥—Ä–µ–µ–≤–∞', '–°–µ—Ä–≥–µ–µ–≤–Ω–∞', 'JJ', '8888888', 'DJI Mini 3 Pro', '900000', '200000', '16.5', '9']
  ];

  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
  testInstallments.forEach(installment => {
    worksheet.addRow(installment);
  });

  // –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
  const headerRow = worksheet.getRow(1);
  headerRow.font = { bold: true };
  headerRow.fill = {
    type: 'pattern',
    pattern: 'solid',
    fgColor: { argb: 'FFE0E0E0' }
  };

  // –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
  worksheet.columns.forEach(column => {
    column.width = Math.max(
      ...column.values.map(v => v ? v.toString().length : 0)
    ) + 2;
  });

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
  const filePath = path.join(__dirname, '../docs/import-templates/installments_template.xlsx');
  await workbook.xlsx.writeFile(filePath);
  console.log(`‚úÖ –§–∞–π–ª —Ä–∞—Å—Å—Ä–æ—á–µ–∫ —Å–æ–∑–¥–∞–Ω: ${filePath}`);
}

// –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –æ—à–∏–±–∫–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
async function generateErrorTestFile() {
  const workbook = new ExcelJS.Workbook();
  const worksheet = workbook.addWorksheet('–ö–ª–∏–µ–Ω—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏');

  // –ó–∞–≥–æ–ª–æ–≤–∫–∏
  const headers = [
    '–ò–º—è',
    '–§–∞–º–∏–ª–∏—è', 
    '–û—Ç—á–µ—Å—Ç–≤–æ',
    '–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞',
    '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞',
    '–¢–µ–ª–µ—Ñ–æ–Ω',
    '–ê–¥—Ä–µ—Å'
  ];

  worksheet.addRow(headers);

  // –î–∞–Ω–Ω—ã–µ —Å –æ—à–∏–±–∫–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  const errorData = [
    ['', '–ü–µ—Ç—Ä–æ–≤', '–°–µ—Ä–≥–µ–µ–≤–∏—á', 'AA', '1234567', '+998901112233', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 10'], // –ü—É—Å—Ç–æ–µ –∏–º—è
    ['–ò–≤–∞–Ω', '', '–°–µ—Ä–≥–µ–µ–≤–∏—á', 'BB', '7654321', '+998902223344', '—É–ª. –ú–∏—Ä–∞, 25'], // –ü—É—Å—Ç–∞—è —Ñ–∞–º–∏–ª–∏—è
    ['–ú–∞—Ä–∏—è', '–°–∏–¥–æ—Ä–æ–≤–∞', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', '', '1111111', '+998903334455', '—É–ª. –ü—É—à–∫–∏–Ω–∞, 7'], // –ü—É—Å—Ç–∞—è —Å–µ—Ä–∏—è
    ['–ê–ª–µ–∫—Å–µ–π', '–ö–æ–∑–ª–æ–≤', '–ò–≤–∞–Ω–æ–≤–∏—á', 'CC', '', '+998904445566', '—É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 15'], // –ü—É—Å—Ç–æ–π –Ω–æ–º–µ—Ä
    ['–ï–ª–µ–Ω–∞', '–ú–æ—Ä–æ–∑–æ–≤–∞', '–ü–µ—Ç—Ä–æ–≤–Ω–∞', 'DD', '2222222', '', '—É–ª. –°–æ–≤–µ—Ç—Å–∫–∞—è, 33'], // –ü—É—Å—Ç–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω
    ['–î–º–∏—Ç—Ä–∏–π', '–í–æ–ª–∫–æ–≤', '–ê–Ω–¥—Ä–µ–µ–≤–∏—á', 'EE', '3333333', '+998905556677', ''], // –ü—É—Å—Ç–æ–π –∞–¥—Ä–µ—Å
    ['–ê–Ω–Ω–∞', '–õ–µ–±–µ–¥–µ–≤–∞', '–î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞', 'FF', '4444444', '–Ω–µ–≤–µ—Ä–Ω—ã–π_—Ç–µ–ª–µ—Ñ–æ–Ω', '—É–ª. –ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤, 18'], // –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    ['–°–µ—Ä–≥–µ–π', '–°–æ–∫–æ–ª–æ–≤', '–ù–∏–∫–æ–ª–∞–µ–≤–∏—á', 'GG', '5555555', '+998907778899', '—É–ª. –ù–æ–≤–∏–∫–æ–≤–∞, 8'], // –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  ];

  errorData.forEach(row => {
    worksheet.addRow(row);
  });

  // –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
  const headerRow = worksheet.getRow(1);
  headerRow.font = { bold: true };
  headerRow.fill = {
    type: 'pattern',
    pattern: 'solid',
    fgColor: { argb: 'FFE0E0E0' }
  };

  worksheet.columns.forEach(column => {
    column.width = Math.max(
      ...column.values.map(v => v ? v.toString().length : 0)
    ) + 2;
  });

  const filePath = path.join(__dirname, '../docs/import-templates/clients_with_errors.xlsx');
  await workbook.xlsx.writeFile(filePath);
  console.log(`‚úÖ –§–∞–π–ª —Å –æ—à–∏–±–∫–∞–º–∏ —Å–æ–∑–¥–∞–Ω: ${filePath}`);
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function main() {
  try {
    console.log('üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö Excel —Ñ–∞–π–ª–æ–≤...\n');
    
    await generateClientsTemplate();
    await generateInstallmentsTemplate();
    await generateErrorTestFile();
    
    console.log('\n‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!');
    console.log('\nüìÅ –§–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ: docs/import-templates/');
    console.log('   - clients_template.xlsx - —à–∞–±–ª–æ–Ω –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤');
    console.log('   - installments_template.xlsx - —à–∞–±–ª–æ–Ω –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ä–∞—Å—Å—Ä–æ—á–µ–∫');
    console.log('   - clients_with_errors.xlsx - —Ñ–∞–π–ª —Å –æ—à–∏–±–∫–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤:', error);
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç
if (require.main === module) {
  main();
}

module.exports = {
  generateClientsTemplate,
  generateInstallmentsTemplate,
  generateErrorTestFile
}; 