/**
 * @file: tasktracker.md
 * @description: Трекер задач по проекту, статусы, прогресс
 * @dependencies: -
 * @created: 2024-07-02
 */

## Спринт 1: Базовая структура и авторизация
- [ ] Инициализация репозитория и документации
- [ ] Настроить backend (NestJS, Prisma, PostgreSQL)
- [ ] Настроить frontend (React, TailwindCSS, shadcn/ui, Zustand, TanStack Query)
- [ ] Реализовать модуль авторизации (login/password, роли)
- [ ] Создать базовые модули: admin, client, customers, installments, payments
- [ ] Разделить API по ролям
- [ ] Реализовать чёрный список (модель, сервис, endpoints для магазина)
- [ ] Реализовать аудит действий (модель, сервис, интеграция)

## Спринт 2: Бизнес-логика и интеграции
- [ ] Чёрный список и проверка просрочек
- [ ] Досрочное закрытие рассрочки
- [ ] Состояния магазина и ограничения доступа
- [ ] Логирование и аудит

## Спринт 3: UI и тестирование
- [ ] Реализовать основные страницы и формы
- [ ] Интеграция с backend
- [ ] Покрытие тестами
- [ ] Документирование API и логики

## Задача: Реализовать хук useDebounce (frontend)
- **Статус**: Выполнено
- **Описание**: Создать универсальный React-хук useDebounce для дебаунса значений, оформить по стандарту проекта, добавить документацию
- **Шаги выполнения**:
  - [x] Реализовать useDebounce с generic-типизацией и задержкой по умолчанию
  - [x] Добавить JSDoc и оформить файл по стандарту
  - [x] Описать хук и пример в docs/project.md
  - [x] Зафиксировать изменение в changelog.md
- **Зависимости**: нет

## Задача: Доработать управление пользователями
- **Статус**: Завершено
- **Описание**: Реализовать универсальную форму пользователя, валидацию, обновление только переданных полей, поддержку статусов и связи с магазином, исправить баг с обновлением storeId
- **Шаги выполнения**:
  - [x] Реализовать универсальную форму UserForm
  - [x] Добавить валидацию для пароля и других полей
  - [x] Обеспечить обновление только переданных полей (включая пароль и магазин)
  - [x] Исправить обновление storeId на backend
  - [x] Обновить документацию
- **Зависимости**: stores

## Задача: Реализация админки
- **Статус**: Завершено
- **Описание**: Полная реализация и тестирование всех функций админки (users, UX, валидация, документация)
- **Шаги выполнения**:
  - [x] Реализовать все формы и таблицы
  - [x] Обеспечить UX, валидацию, адаптивность
  - [x] Провести тестирование и устранить баги
  - [x] Синхронизировать документацию
- **Зависимости**: users, stores

## Задача: Исправить отображение рассрочек на детальной странице клиента
- **Статус**: Выполнено
- **Описание**: Реализовать отдельный endpoint для получения рассрочек клиента, обновить фронт для использования этого endpoint
- **Шаги выполнения**:
  - [x] Добавить endpoint на бэкенде
  - [x] Реализовать метод в сервисе
  - [x] Обновить API на фронте
  - [x] Перевести страницу клиента на новый endpoint
  - [x] Обновить документацию
- **Зависимости**: customers, installments

## Задача: Улучшить глобальный поиск по паспорту
- **Статус**: Выполнено
- **Описание**: Фильтровать результат поиска по паспорту — показывать только магазины с просрочкой или блокировкой, красиво отображать на фронте
- **Шаги выполнения**:
  - [x] Изменить логику поиска на бэкенде
  - [x] Обновить отображение на фронте
  - [x] Обновить документацию
- **Зависимости**: customers, installments, blacklist 

## Задача: Упростить логику чёрного списка
- **Статус**: Выполнено
- **Описание**: Удалить таблицу Blacklist и всю связанную логику, оставить только флаг isBlacklisted у клиента
- **Шаги выполнения**:
  - [x] Удалить модель Blacklist из Prisma
  - [x] Удалить сервисы, контроллеры, DTO, формы, связанные с Blacklist
  - [x] Перевести весь функционал на работу только с isBlacklisted
  - [x] Обновить документацию
- **Зависимости**: customers 

## Задача: Унифицировать формат API-ответов и пагинации
- **Статус**: Выполнено
- **Описание**: Внедрить универсальный формат success/data/error для всех API-ответов и пагинации
- **Шаги выполнения**:
  - [x] Создать тип ApiResponse на фронте
  - [x] Реализовать глобальный интерцептор для успешных ответов
  - [x] Привести фильтр ошибок к единому формату
  - [x] Обновить методы с пагинацией (пример: клиенты)
  - [x] Обновить документацию
- **Зависимости**: backend, frontend 

## Задача: Привести id к number в контроллерах
- **Статус**: Выполнено
- **Описание**: Во всех контроллерах backend преобразовать все id и внешние ключи из params/query/body к типу number перед передачей в сервисы (Number(id)), чтобы соответствовать типу Int в Prisma и избежать ошибок типов.
- **Шаги выполнения**:
  - [x] Найти все места, где id, storeId, customerId и др. приходят из params/query/body
  - [x] Преобразовать их к number (`Number(id)`) в контроллерах
  - [x] Протестировать работу всех endpoints с числовыми id (ручное и автотестирование)
  - [x] Обновить документацию
- **Чеклист**:
  - [x] Все основные контроллеры приведены к стандарту
  - [x] Ошибки типов устранены
  - [x] Документация и changelog синхронизированы
- **Зависимости**: все модули backend 

## Задача: Реализовать детальную страницу рассрочки с управлением платежами
- **Статус**: Выполнено
- **Описание**: Реализовать страницу installments/[id] с получением и отображением полной информации о рассрочке, графиком платежей, возможностью оплаты и досрочного закрытия. Вся логика управления платежами временно реализуется через эту страницу.
- **Шаги выполнения**:
  - [x] Получение и отображение полной информации о рассрочке
  - [x] График платежей с возможностью оплаты
  - [x] Досрочное закрытие рассрочки
  - [x] История платежей и статусы
  - [x] Обновить документацию (project.md, changelog.md, tasktracker.md)
- **Зависимости**: installments, payments 

## Задача: Упростить логику статусов магазинов
- **Статус**: В процессе
- **Описание**: Оставить только статусы active/inactive, убрать payment_overdue, реализовать запрет авторизации для менеджеров неактивных магазинов, обновить отображение на фронте и документацию
- **Шаги выполнения**:
  - [x] Обновить описание статусов и бизнес-логику в /docs/project.md
  - [ ] Обновить backend: модель, сервис, контроллер, DTO, миграции
  - [ ] Обновить frontend: отображение статусов, обработка ошибок авторизации
  - [ ] Обновить changelog и tasktracker
- **Зависимости**: stores, users, auth 

## Задача: Перенести импорт клиентов и рассрочек на клиентскую часть
- **Статус**: Выполнено
- **Описание**: Импорт теперь доступен только для менеджеров магазинов через клиентский интерфейс. Модуль admin/import удалён.
- **Шаги выполнения**:
  - [x] Обновить документацию
  - [x] Удалить модуль admin/import
  - [x] Перенести логику импорта на клиентскую часть 

## Задача: Внедрить PWA для фронтенда
- **Статус**: Выполнено
- **Описание**: Реализована поддержка PWA (установка, manifest, splash screen, иконки, meta-теги). Офлайн-режим не используется.
- **Шаги выполнения**:
  - [x] Добавить manifest.json
  - [x] Добавить иконки
  - [x] Настроить vite-plugin-pwa
  - [x] Обновить index.html
  - [x] Проверить установку приложения
  - [x] Обновить документацию

## Задача: Реализовать импорт Excel файлов
- **Статус**: Выполнено
- **Описание**: Создать функциональность импорта клиентов и рассрочек из Excel файлов для менеджеров магазинов
- **Шаги выполнения**:
  - [x] Создать модуль импорта на backend (ImportModule, ImportService, ImportController)
  - [x] Реализовать обработку Excel файлов с валидацией
  - [x] Создать скрипт для генерации тестовых файлов
  - [x] Добавить кнопки импорта на страницы клиентов и рассрочек
  - [x] Настроить модальное окно для загрузки файлов
  - [x] Протестировать функциональность
  - [x] Обновить документацию
- **Зависимости**: customers, installments, exceljs 

## Задача: Упростить логику досрочного погашения рассрочки
- **Статус**: Выполнено
- **Описание**: Досрочное погашение теперь возможно в любой момент при отсутствии просрочек, все pending-платежи отменяются, создаётся один платёж с type = "early_payoff", status = "paid", сумма = остаток основного долга (без процентов). Рассрочка переводится в статус "early_payoff".
- **Шаги выполнения**:
  - [x] Обновить backend-логику payOffEarly
  - [x] Обновить changelog.md, project.md, tasktracker.md
  - [x] Проверить отображение на фронте
- **Зависимости**: installments, payments, frontend 