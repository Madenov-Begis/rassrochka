/**
 * @file: changelog.md
 * @description: Журнал изменений проекта
 * @dependencies: -
 * @created: 2024-07-02
 */

## [2024-07-02] - Инициализация проекта
### Добавлено
- Создана структура документации: project.md, tasktracker.md, changelog.md, diary.md, qa.md
- Описаны архитектура, модули, роли, бизнес-логика

### Изменено
- Нет

### Исправлено
- Нет

## [2024-07-03] - Чёрный список и аудит
### Добавлено
- Модель Blacklist для чёрного списка клиентов (Prisma, миграция)
- Модель AuditLog для аудита действий (Prisma, миграция)
- Описание бизнес-логики: магазин может вносить клиента в чёрный список, админ только просматривает
- Универсальный React-хук useDebounce для дебаунса значений (frontend)
- Описание и пример использования в docs/project.md
- Переиспользуемый компонент Pagination для серверной пагинации (frontend)
- Описание и пример использования в docs/project.md

### Изменено
- Обновлён project.md — добавлен раздел о чёрном списке и аудите, уточнена логика
- Внедрён компонент Pagination на странице admin/stores (магазины)

### Исправлено
- Исправлены связи моделей Customer и Blacklist 

## [2025-07-03] - Исправление отображения рассрочек на детальной странице клиента
### Добавлено
- Новый endpoint: `GET /api/client/customers/:id/installments` для получения рассрочек конкретного клиента
- Метод customersApi.getInstallments на фронте

### Изменено
- Детальная страница клиента теперь использует новый endpoint для загрузки рассрочек
- Обновлён project.md (описание API)

### Исправлено
- Рассрочки других клиентов больше не отображаются на детальной странице клиента

## [2025-07-04] - Завершена реализация админки
### Добавлено
- Полный функционал управления пользователями (создание, редактирование, статусы, смена пароля, связь с магазином)
- Современный UI/UX, валидация, адаптивность
### Изменено
- Код приведён к единому стилю, удалены дубли, все импорты и типы корректны
### Исправлено
- Все выявленные баги по users

## [2025-07-04] - Улучшен глобальный поиск по паспорту
### Изменено
- Глобальный поиск по паспорту теперь возвращает только магазины, где клиент либо в чёрном списке, либо имеет просроченные рассрочки
- Результаты поиска на фронте отображаются в виде карточек с выделением проблемных магазинов, подробной информацией и списком просрочек 

## [2025-07-04] - Упрощение логики чёрного списка
### Изменено
- Удалена таблица Blacklist и вся связанная логика
- Для блокировки клиента теперь используется только флаг isBlacklisted в таблице клиентов 

## [2024-07-05] - Унификация формата API-ответов и пагинации
### Добавлено
- Глобальный интерцептор для успешных ответов (success/data)
- Универсальный фильтр ошибок (success: false, error, code)
- Единый формат пагинации: data: { items, total, page, totalPages }
- Тип ApiResponse на фронте

### Изменено
- Обновлён project.md — описание формата API-ответов и пагинации 

## [2025-07-05] - Приведение id к number в контроллерах
### Изменено
- Во всех контроллерах backend теперь все id и внешние ключи из params/query/body преобразуются к number перед передачей в сервисы (Number(id)).
- Обновлён project.md — добавлен раздел о преобразовании id к number. 

## [2025-07-09] - Детальная страница рассрочки и управление платежами
### Добавлено
- Реализована детальная страница рассрочки (front/src/pages/store/installments/[id].tsx):
  - Получение и отображение полной информации о рассрочке
  - График платежей с возможностью оплаты
  - Досрочное закрытие рассрочки
  - История платежей и статусы
- Вся логика управления платежами временно реализована через эту страницу (без отдельного модуля payments)

### Изменено
- Обновлён project.md — добавлен раздел о детальной странице рассрочки и управлении платежами

### Исправлено
- Нет 

## [2025-07-10] - Упрощение логики статусов магазинов
### Изменено
- Оставлены только два статуса магазина: active (полный доступ) и inactive (доступ запрещён)
- Удалён статус payment_overdue и все связанные проверки
- Если магазин inactive, все менеджеры этого магазина не могут войти (backend возвращает ошибку, frontend отображает её)
- В списках отображаются все магазины, независимо от статуса 

## [2024-07-11] - Улучшена логика предстоящих платежей
### Изменено
- В методе getUpcoming теперь учитываются все платежи с dueDate за сегодня и следующие 7 дней (с 00:00 до 23:59), чтобы не терялись платежи, если пользователь заходит после времени платежа 

## [2025-07-15] - Перенос импорта на клиентскую часть
### Изменено
- Импорт клиентов и рассрочек теперь реализован на клиенте (менеджер магазина)
- Удалён модуль admin/import на backend 

## [2025-07-16] - Внедрение PWA для фронтенда
### Добавлено
- Поддержка установки приложения на рабочий стол/мобильный (PWA)
- Manifest, splash screen, иконки, meta-теги

### Изменено
- Обновлён project.md — добавлен раздел о PWA

## [2024-07-16] - Реализован импорт Excel файлов
### Добавлено
- Модуль импорта клиентов и рассрочек (backend/src/modules/client/import/)
- Сервис ImportService для обработки Excel файлов
- Контроллер ImportController с endpoints для загрузки
- Скрипт generate-test-excel.js для создания тестовых файлов
- Тестовые Excel файлы в docs/import-templates/
- Кнопки импорта на страницах клиентов и рассрочек
- Модальное окно ImportModal для загрузки файлов

### Изменено
- Добавлен модуль ImportModule в ClientModule
- Обновлены страницы клиентов и рассрочек с кнопками импорта
- Исправлены endpoints для корректной работы с авторизацией

### Исправлено
- Валидация данных при импорте
- Обработка ошибок с детальным описанием
- Поддержка только .xlsx файлов

## [2024-07-16] - Модуль платежей полностью реализован
### Добавлено
- Полный модуль платежей с тремя страницами:
  - Список платежей (`/store/payments`) с поиском, пагинацией и статусами
  - Детали платежа (`/store/payments/:id`) с полной информацией и действиями
  - Календарь платежей (`/store/payments/calendar`) с визуализацией и статистикой
- Backend API для платежей: список, детали, оплата, просроченные, предстоящие
- Бизнес-логика оплаты с автоматическим распределением по графику
- Поддержка частичной оплаты и перерасчёта графика
- Автоматическое завершение рассрочки при полной оплате

### Изменено
- Обновлён project.md — добавлено подробное описание модуля платежей
- Улучшена навигация между страницами платежей

### Исправлено
- Корректное отображение статусов платежей
- Правильный расчёт просрочки в днях
- Исправлен порядок колонок в таблице платежей (статус и дата)
- Улучшено отображение товара в таблице (название + ID рассрочки)
- Исправлено отображение платежей в календаре
- Добавлена кнопка "Назад" в календарь платежей

## [2024-07-16] - Календарь платежей добавлен в боковое меню
### Добавлено
- Календарь платежей теперь доступен как отдельный пункт в боковом меню
- Иконка Calendar для пункта календаря
- Новый роут `/store/calendar` для прямого доступа к календарю

### Изменено
- Убрана кнопка "Календарь" со страницы списка платежей
- Убрана кнопка "Назад" из календаря (теперь доступен напрямую)
- Обновлена навигация: календарь стал полноценным разделом
- Изменён путь календаря с `/store/payments/calendar` на `/store/calendar`

### Исправлено
- Нет 

## [2024-07-16] - Редизайн дашборда магазина
### Изменено
- Карточки статистики на дашборде магазина объединены и упрощены: теперь только ключевые метрики без дублирующих карточек
- Убраны лишние иконки и подписи, цветовые акценты только для важных метрик (просрочки, чёрный список)
- Визуальное разделение на блоки "Рассрочки" и "Клиенты"
- Обновлено описание дашборда в project.md 

## [2024-07-16] - Откат редизайна дашборда магазина
### Изменено
- Возвращена прежняя структура карточек и статистики на дашборде магазина
- Удалён экспериментальный редизайн 